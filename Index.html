<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MASTER FLIX PRO</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root { --red: #e50914; --dark: #141414; }
        body { background: var(--dark); color: white; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; margin: 0; overflow-x: hidden; }
        
        /* HEADER */
        header { 
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
            padding: 15px 4%; display: flex; align-items: center; justify-content: space-between;
            position: fixed; width: 92%; z-index: 1000;
        }
        .logo { color: var(--red); font-size: 25px; font-weight: bold; text-decoration: none; }
        .nav-right { display: flex; gap: 15px; align-items: center; }
        .search-bar { background: rgba(0,0,0,0.5); border: 1px solid white; padding: 5px 10px; border-radius: 4px; display: flex; align-items: center; }
        .search-bar input { background: transparent; border: none; color: white; outline: none; width: 120px; }

        /* HERO BANNER */
        .hero { height: 70vh; background-size: cover; background-position: center; display: flex; align-items: center; padding: 0 4%; position: relative; }
        .hero-content { max-width: 600px; z-index: 2; }
        .hero-title { font-size: 3rem; margin-bottom: 10px; }

        /* ROWS (LISTAS) */
        .container { padding: 0 4%; margin-top: -80px; position: relative; z-index: 5; }
        .row { margin-bottom: 30px; }
        .row-title { font-size: 1.2rem; margin-bottom: 10px; font-weight: bold; }
        .movie-list { display: flex; overflow-x: auto; gap: 10px; padding: 10px 0; }
        .movie-list::-webkit-scrollbar { display: none; }
        
        .card { min-width: 200px; height: 110px; cursor: pointer; transition: 0.3s; border-radius: 4px; position: relative; }
        .card:hover { transform: scale(1.15); z-index: 10; }
        .card img { width: 100%; height: 100%; object-fit: cover; border-radius: 4px; }
        .card-info { position: absolute; bottom: 5px; left: 5px; font-size: 10px; background: rgba(0,0,0,0.7); padding: 2px 5px; }

        /* ADMIN PANEL */
        #admin-panel { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #111; z-index: 2000; padding: 50px; overflow-y: auto; box-sizing: border-box; }
        .form-group { margin-bottom: 15px; }
        input, select, textarea { width: 100%; padding: 12px; background: #333; border: 1px solid #444; color: white; border-radius: 4px; }
        .btn { padding: 12px 25px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .btn-red { background: var(--red); color: white; }

        /* PLAYER */
        #player-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 3000; }
        video { width: 100%; height: 100%; }
        .close-player { position: absolute; top: 20px; left: 20px; color: white; font-size: 30px; cursor: pointer; z-index: 3001; }
        
        .hidden { display: none; }
    </style>
</head>
<body>

<header>
    <a href="#" class="logo">MASTER FLIX</a>
    <div class="nav-right">
        <div class="search-bar">
            <i class="fas fa-search"></i>
            <input type="text" id="search-input" placeholder="Buscar..." onkeyup="search()">
        </div>
        <button id="btn-admin-view" class="btn btn-red hidden" onclick="toggleAdmin(true)">PAINEL MASTER</button>
        <button class="btn btn-red" onclick="logout()">SAIR</button>
    </div>
</header>

<div id="main-content">
    <div class="hero" id="hero-banner">
        <div class="hero-content">
            <h1 class="hero-title" id="hero-title">Carregando...</h1>
            <p id="hero-desc"></p>
            <button class="btn btn-red" onclick="playCurrentHero()">Assistir</button>
        </div>
    </div>

    <div class="container">
        <div id="row-search" class="row hidden"><div class="row-title">Busca</div><div class="movie-list" id="list-search"></div></div>
        <div id="row-movies" class="row"><div class="row-title">Filmes</div><div class="movie-list" id="list-movies"></div></div>
        <div id="row-series" class="row"><div class="row-title">Séries</div><div class="movie-list" id="list-series"></div></div>
        <div id="row-docs" class="row"><div class="row-title">Documentários</div><div class="movie-list" id="list-docs"></div></div>
    </div>
</div>

<div id="admin-panel">
    <h1>Painel de Controle - Master</h1>
    <div class="form-group">
        <label>Tipo</label>
        <select id="adm-type"><option value="movie">Filme</option><option value="tv">Série</option></select>
    </div>
    <div class="form-group"><label>ID do TMDB</label><input type="text" id="adm-id" placeholder="Ex: 603"></div>
    <div class="form-group"><label>Link do Vídeo</label><input type="text" id="adm-url" placeholder="Gdrive, Mediafire, etc"></div>
    <div class="form-group"><label>Link da Legenda (.vtt)</label><input type="text" id="adm-sub" placeholder="Opcional"></div>
    <button class="btn btn-red" onclick="saveMedia()">SALVAR MÍDIA</button>
    <button class="btn" style="background: #444; color: white;" onclick="toggleAdmin(false)">FECHAR PAINEL</button>
</div>

<div id="player-modal">
    <span class="close-player" onclick="closePlayer()"><i class="fas fa-arrow-left"></i> Sair</span>
    <video id="video-player" controls>
        <track id="video-track" kind="subtitles" srclang="pt" label="Português" default>
    </video>
</div>

<script>
    // --- 1. CONFIGURAÇÕES (INSIRA SEUS DADOS AQUI) ---
    const TMDB_KEY = "SUA_CHAVE_TMDB"; 
    const firebaseConfig = {
        apiKey: "SUA_API_KEY",
        authDomain: "SEU_PROJETO.firebaseapp.com",
        databaseURL: "https://SEU_PROJETO.firebaseio.com",
        projectId: "SEU_PROJETO",
        appId: "SEU_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();
    let catalog = [];
    let currentHero = null;

    // --- 2. CONTROLE DE ACESSO ---
    auth.onAuthStateChanged(user => {
        if(user) {
            db.ref('users/' + user.uid).once('value', snap => {
                if(snap.val()?.role === 'admin') document.getElementById('btn-admin-view').classList.remove('hidden');
                loadData();
            });
        } else {
            const email = prompt("Seu Email:");
            const senha = prompt("Sua Senha:");
            auth.signInWithEmailAndPassword(email, senha).catch(() => alert("Acesso Negado"));
        }
    });

    // --- 3. FUNÇÕES DO CATÁLOGO ---
    async function saveMedia() {
        const type = document.getElementById('adm-type').value;
        const id = document.getElementById('adm-id').value;
        const video = document.getElementById('adm-url').value;
        const sub = document.getElementById('adm-sub').value;

        const res = await fetch(`https://api.themoviedb.org/3/${type}/${id}?api_key=${TMDB_KEY}&language=pt-BR`);
        const d = await res.json();

        const payload = {
            id: id,
            title: d.title || d.name,
            img: `https://image.tmdb.org/t/p/w500${d.backdrop_path}`,
            hero: `https://image.tmdb.org/t/p/original${d.backdrop_path}`,
            desc: d.overview,
            video: video,
            sub: sub,
            type: type,
            views: 0,
            isDoc: d.genres.some(g => g.id === 99)
        };

        db.ref('catalog').push(payload).then(() => { alert("Salvo!"); location.reload(); });
    }

    function loadData() {
        db.ref('catalog').on('value', snap => {
            catalog = [];
            const lists = { movie: document.getElementById('list-movies'), tv: document.getElementById('list-series'), doc: document.getElementById('list-docs') };
            Object.values(lists).forEach(l => l.innerHTML = "");

            snap.forEach(child => {
                const m = child.val();
                m.key = child.key;
                catalog.push(m);

                const html = `
                    <div class="card" onclick="playMovie('${m.video}', '${m.sub}', '${m.key}')">
                        <img src="${m.img}">
                        <div class="card-info"><i class="fas fa-eye"></i> ${m.views || 0}</div>
                    </div>
                `;
                
                if(m.isDoc) lists.doc.innerHTML += html;
                else lists[m.type].innerHTML += html;
            });
            setHero(catalog[0]);
        });
    }

    // --- 4. PLAYER E VIEWS ---
    function playMovie(url, sub, key) {
        // Incrementa visualização
        db.ref('catalog/' + key + '/views').transaction(v => (v || 0) + 1);
        
        const p = document.getElementById('video-player');
        p.src = url;
        if(sub) document.getElementById('video-track').src = sub;
        document.getElementById('player-modal').style.display = 'block';
        p.play();
    }

    function closePlayer() {
        document.getElementById('video-player').pause();
        document.getElementById('player-modal').style.display = 'none';
    }

    // --- 5. BUSCA E UI ---
    function search() {
        const q = document.getElementById('search-input').value.toLowerCase();
        const res = catalog.filter(m => m.title.toLowerCase().includes(q));
        const row = document.getElementById('row-search');
        const list = document.getElementById('list-search');

        if(q.length > 2) {
            row.classList.remove('hidden');
            list.innerHTML = "";
            res.forEach(m => {
                list.innerHTML += `<div class="card" onclick="playMovie('${m.video}', '${m.sub}', '${m.key}')"><img src="${m.img}"></div>`;
            });
        } else { row.classList.add('hidden'); }
    }

    function setHero(m) {
        if(!m) return;
        currentHero = m;
        document.getElementById('hero-banner').style.backgroundImage = `linear-gradient(to right, #141414, transparent), url('${m.hero}')`;
        document.getElementById('hero-title').innerText = m.title;
        document.getElementById('hero-desc').innerText = m.desc.substring(0, 150) + "...";
    }

    function playCurrentHero() { playMovie(currentHero.video, currentHero.sub, currentHero.key); }

    function toggleAdmin(show) { document.getElementById('admin-panel').style.display = show ? 'block' : 'none'; }
    
    function logout() { auth.signOut().then(() => location.reload()); }
</script>
</body>
</html>
